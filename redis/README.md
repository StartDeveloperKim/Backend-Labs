# Redis
## Redis (Remote Dictionary Server)

- Redis는 원격에 위치하고 프로세스로 존재하는 In-Memory 기반의 key-value 구조 데이터 관리 서버 시스템이다.
- key-value 구조이기에 RDB와 같이 쿼리 연산을 지원하지 않지만, 데이터의 고속 읽기와 쓰기에 최적화 되어있다.
- 그래서 Redis는 일종의 NoSQL로 분류되기도 한다.
- 일반 DB 같이 디스크(하드, SSD)에 데이터를 쓰는 구조가 아니라 메모리에서 데이터를 처리하기 때문에 작업 속도가 상당히 빠르다.

## 특징

- key-value 구조의 데이터 관리 시스템
- 메모리 기반이라 모든 데이터들을 메모리에 저장하고 조회에 매우 빠름
- 다양한 자료구조를 지원한다.
- 메모리 기반이지만 Redis는 영속적인 데이터 보존이 가능하다.
- 스냅샷 기능을 제공해 메모리 내용을 *.rdb 파일로 저장하여 해당 시점으로 복구할 수 있다.
- Redis는 기본적으로 싱글 쓰레드로 수행되기 때문에 안정적인 인프라를 구축하기 위해서는 Replication(Master-Slave 구조) 필수이다.

---

## 그럼 어떻게 이용할까??

### 캐시(Cache)

Cache란 한번 조회된 데이터를 미리 특정 공간에 저장해놓고, 똑같은 요청이 발생하게 되면 서버에게 다시 요청하지 말고 저장해놓은 데이터를 제공해서 빠르게 서비스를 제공해주는 것을 의미한다.

### 스케일 아웃에 따른 세션 서버

스케일 아웃을 하면 다중 서버 환경이므로 세션을 관리하기가 까다롭다. 이 때 Redis를 활용하여 세션정보를 저장하는 서버로서 활용할 수 있다.

### 인증 토큰 등을 저장, Ranking 보드로 사용, 유저 API Limit

---

## 캐시의 구조 패턴

### Look aside Cache 패턴

캐시먼저 조회를 하는 패턴이다.

1. 클라이언트에서 데이터 요청
2. 서버에서 캐시에 데이터 존재 유무 확인
3. 데이터가 있다면 캐시의 데이터 사용(빠른 조회)
4. 데이터가 없다면 실제 DB 데이터에 접근
5. 그리고 DB에서 가져 온 데이터를 캐시에 저장하고 클라이언트에 반환

→ 캐시에서 찾는 것을 Cache Hit, 없다면 Cache Miss라고 한다.

### Write Back 패턴

write back은 주로 쓰기 작업이 굉장히 많아서, INSERT 쿼리를 일일이 날리지 ㅇ낳고 한꺼번에 배치 러리를 하기 위해 사용한다.

한꺼번에 많은 INSERT 요청이 DB로 들어가면 DB 서버가 죽을 수도 있다. 따라서 이러한 쓰기 작업을 캐시서버에 저장해두고 순차적으로 한다면 안전하게 작업을 진행할 수 있다.

Write Back 패턴은 성능을 향상시킬 수는 있지만 DB에 데이터를 저장하기 전에 캐시 서버가 죽으면 데이터가 유실된다는 단점이 있다.

1. 우선 모든 데이터를 캐시에 싹 저장
2. 캐시의 데이터를 일정 주기마다 DB에 한꺼번에 저장(배치)
3. 그리고나선 DB에 저장했으니 잔존 데이터를 캐시에서 제

---

## Redis vs Memcached

### MemCached

- 메모리가 삭제되어도 원본 데이터로 복구가 가능하며 장애가 발생하지 않는 경우
- 단순 조회로 통신 속도만을 향상시키는 목적인 경우

### Redis

- 메모리가 삭제되었을 때 서비스 장애가 발생할 수 있는 경우
    - Redis는 데이터 영속성을 보장하기 때문
- 서비스의 특정 기능을 위한 목적으로 사용하는 경우
    - 다양한 데이터 타입을 활용해서 사용할 때

---

## Redis 주의할 점

### 시간 복잡도

Redis는 싱글 쓰레드로 동작하므로 긴 처리시간이 필요한 명령어를 쓰면 불리하고 요청 건을 처리하기 전까지 다른 서비스 요청을 받아들일 수 없고 서버가 다운 되는 현상이 일어날 수 있다.

### 메모리 파편화

메모리를 할당 받고 해제하는 과정에서 아래 그림과 같이 부분부분 빈 공간이 생긴다. 이 때 비어있는 공간을 사용할 수 없게되면 이 공간은 낭비되는 것이다. 그리고 이러한 현상이 지속되다보면 실제 physical 메모리가 커져 프로세스가 죽을 수도 있다. 따라서 Redis를 사용할 때 메모리를 적당히 여유있게 사용하는 것이 좋다.
